@using System.Globalization;

@model Priority_Q.Models.Restaurant

@{
    ViewBag.Title = "View Restaurant";
    var restaurant = ViewData["Restaurant"] as Priority_Q.Models.Restaurant;
    var allTables = ViewData["AllTables"] as IEnumerable<Priority_Q.Models.Table>;
    var allCustomers = ViewData["AllCustomers"] as IEnumerable<Priority_Q.Models.Customer>;
    var mostRecentNews = ViewData["MostRecentNews"] as Priority_Q.Models.NewsInfo;
    var tableCapacityCount = ViewData["TableCapacityCount"] as SortedDictionary<int, int>;
}

@functions {
    private String ConvertIntTo24Hour(int number)
    {
        String convertToString = number.ToString().PadLeft(2, '0');
        DateTime convertToDateTime = DateTime.ParseExact(convertToString, "HH", CultureInfo.CurrentCulture);
        return convertToDateTime.ToString("h:mm tt");
    }
}

<h2>@restaurant.Name</h2>

<!-- Basic restaurant info (location, opening hours, etc.)-->
<span class="glyphicon glyphicon-map-marker"></span> @restaurant.StreetAddress , @restaurant.City &emsp;
<span class="glyphicon glyphicon-time"></span> @ConvertIntTo24Hour(restaurant.OpeningHourStart) - @ConvertIntTo24Hour(restaurant.OpeningHourEnd)
<br />
<span class="glyphicon glyphicon-earphone"></span> @restaurant.PhoneNumber

<p></p>

<div class="panel panel-default">
    <div class="panel-body">
        <h3>
            Tables Available <span class="label label-default">@ViewBag.AvailableTablesCount</span> 
            &emsp; 
            <a class="btn btn-info" href='@string.Format("/Restaurants/CustomerAllTables/{0}", restaurant.ID)'>View Full Map</a>
        </h3>

        <!-- List all empty tables -->
        <table class="table table-striped table-hover ">
            <!-- contents -->
            @{
                var counter = 1;
               
            }
            <tr>
                <td>
                @foreach (var pair in tableCapacityCount)
                {
                    if (pair.Value > 1)
                    {
                        <span>@pair.Value tables</span>
                    }
                    else
                    {
                        <span>@pair.Value table</span>
                    }
                    <span class="btn btn-success disabled">
                        @pair.Key<span class="glyphicon glyphicon-user"></span>
                    </span>
                    <span>&emsp;</span>
                }
                </td>
            </tr>

            <tr>
                <td>
                    Reservation Times
                    <!-- List reservation times -->
                    <select>
                        <option value="-1">--- See All Available Times ---</option>
                        @for (var i = restaurant.OpeningHourStart; i < restaurant.OpeningHourEnd; i++)
                        {
                            <option value="@i.ToString()">@ConvertIntTo24Hour(i)</option>
                        }
                    </select>
                </td>
            </tr>
        </table>

        <!-- Manage Priority Queue -->
        <h3>
            Priority Queue <span class="label label-default">@allCustomers.Count()</span>
        </h3>
        <table class="table table-striped table-hover ">
            <!-- contents -->
            @{
                counter = 0;
            }
            <tr>
                <td>
                    <span class="label label-success">#1</span>
                    @foreach (var item in allCustomers)
                    {  
                        <span class="btn btn-primary disabled">
                            @item.GroupCapacity<span class="glyphicon glyphicon-user"></span> <br />
                            @item.Name
                        </span>
                        <span>
                            &emsp;
                        </span>
                        counter++;
                    }
                    <span class="label label-danger">#@counter</span>
                </td>
            </tr>
        </table>
    </div>
</div>

<!-- Check if there's any news for today-->
@if (mostRecentNews != null)
{
    <div class="alert alert-dismissible alert-info">
        <button type="button" class="close" data-dismiss="alert">×</button>

        @mostRecentNews.Content <br />
        <i>Posted On @mostRecentNews.Date</i>

        <br />

        <a class="btn btn-info" href='@string.Format("/Restaurants/ViewNews/{0}", restaurant.ID)'>
            &laquo; View All &raquo;
        </a>

    </div>
}
