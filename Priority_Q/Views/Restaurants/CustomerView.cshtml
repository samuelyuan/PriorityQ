@using System.Globalization;

@model Priority_Q.Models.Restaurant

@{
    ViewBag.Title = "View Restaurant";
    var restaurant = ViewData["Restaurant"] as Priority_Q.Models.Restaurant;
    var allTables = ViewData["AllTables"] as IEnumerable<Priority_Q.Models.Table>;
    var allCustomers = ViewData["AllCustomers"] as IEnumerable<Priority_Q.Models.Customer>;
    var mostRecentNews = ViewData["MostRecentNews"] as Priority_Q.Models.NewsInfo;
    var tableCapacityCount = ViewData["TableCapacityCount"] as SortedDictionary<int, int>;
}

@functions {
    private String ConvertIntTo24Hour(int number)
    {
        String convertToString = number.ToString().PadLeft(2, '0');
        DateTime convertToDateTime = DateTime.ParseExact(convertToString, "HH", CultureInfo.CurrentCulture);
        return convertToDateTime.ToString("h:mm tt");
    }
}

<h2>@restaurant.Name</h2>

<!-- Basic restaurant info (location, opening hours, etc.)-->
<span class="glyphicon glyphicon-map-marker"></span> @restaurant.StreetAddress , @restaurant.City &emsp;
<span class="glyphicon glyphicon-time"></span> @ConvertIntTo24Hour(restaurant.OpeningHourStart) - @ConvertIntTo24Hour(restaurant.OpeningHourEnd)
<br />
<span class="glyphicon glyphicon-earphone"></span> @restaurant.PhoneNumber

<p></p>

<!-- Full Map Modal -->
<div class="modal fade" id="fullMapModal" tabindex="-1" role="dialog" aria-labelledby="fullMapModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Full Map</h4>
            </div>
            <div class="modal-body">
                @Html.Partial("_CustomerAllTables")
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-body">
        <h3>
            Tables Available <span class="label label-default">@ViewBag.AvailableTablesCount</span> 
            &emsp; 
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#fullMapModal">
                View Full Map
            </button>
        </h3>

        <!-- List all empty tables -->
        <table class="table table-striped table-hover ">
            <!-- contents -->
            @{
                var counter = 1;
               
            }
            <tr>
                <td>
                @foreach (var pair in tableCapacityCount)
                {
                    if (pair.Value > 1)
                    {
                        <span>@pair.Value tables</span>
                    }
                    else
                    {
                        <span>@pair.Value table</span>
                    }
                    <span class="btn btn-success disabled">
                        @pair.Key<span class="glyphicon glyphicon-user"></span>
                    </span>
                    <span>&emsp;</span>
                }
                </td>
            </tr>

            <tr>
                <td>
                    Reservation Times
                    <!-- List reservation times -->
                    <select>
                        <option value="-1">--- See All Available Times ---</option>
                        @for (var i = restaurant.OpeningHourStart; i < restaurant.OpeningHourEnd; i++)
                        {
                            for (var minutes = 0; minutes < 60; minutes += 30)
                            { 
                                var displayTime = (new DateTime()).AddHours(i).AddMinutes(minutes).ToString("h:mm tt");
                                
                                <option value="@displayTime">@displayTime</option>
                            }
                        }
                    </select>
                </td>
            </tr>
        </table>

        <!-- Manage Priority Queue -->
        <h3>
            Priority Queue <span class="label label-default">@allCustomers.Count()</span>
        </h3>
        <table class="table table-striped table-hover ">
            <!-- contents -->
            @{
                counter = 0;
            }
            <tr>
                <td>
                    <span class="label label-success">#1</span>
                    @foreach (var item in allCustomers)
                    {  
                        <span class="btn btn-primary disabled">
                            @item.GroupCapacity<span class="glyphicon glyphicon-user"></span> <br />
                            @item.Name
                        </span>
                        <span>
                            &emsp;
                        </span>
                        counter++;
                    }
                    <span class="label label-danger">#@counter</span>
                </td>
            </tr>
        </table>
    </div>
</div>

<!-- Check if there's any news for today-->
@if (mostRecentNews != null)
{
    <a class="btn btn-info" role="button" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
        Recent Updates
        <a class="btn btn-info" href='@string.Format("/Restaurants/ViewNews/{0}", restaurant.ID)'>
            View All Updates
        </a>
    </a>
    
    <div class="collapse" id="collapseExample">
        <div class="well">
            @mostRecentNews.Content <br />
            <i>Posted On @mostRecentNews.Date</i>

            <br />
        </div>
    </div>
}
