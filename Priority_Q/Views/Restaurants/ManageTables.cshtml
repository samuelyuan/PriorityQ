@model IEnumerable<Priority_Q.Models.Table>

@{
    ViewBag.Title = "Manage Tables";
}

@functions {
    private String DisplayTableData(int counter, Priority_Q.Models.Table item)
    {
        return "#" + counter + " --- [Max: " + item.MaxCapacity + "]";
    }

    private Boolean IsOwner()
    {
        return (Request.IsAuthenticated && ViewBag.OwnsRestaurant);
    }
}

<h2>@ViewBag.RestaurantName</h2>
<h3>Tables Available
    <span class="label label-default">
        @ViewBag.AvailableTables / @ViewBag.TotalTables
    </span>
    &nbsp;
    @if (IsOwner())
    {
        //create a new table just for that restaurant
        <a class="btn btn-info" href='@string.Format("/Tables/Create/{0}", ViewBag.RestaurantId)'>
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        </a>
    }
</h3>

<!-- The data passed in is a list of tables for a restaurant -->
<table class="table table-striped table-hover ">
    <!-- contents -->
    @{
        var counter = 1;
        var numPerRow = (int)Math.Truncate(Math.Sqrt(Model.Count()));
    }
        <tr>
            @foreach (var item in Model)
            {
                if (counter % numPerRow == 1)
                {
                    @: <tr>
                }
                
                <td>
                    <span class="label label-default">#@counter</span> <br />
                    @if (!item.IsOccupied)
                    {
                        <span class="btn btn-success disabled">
                            [Max: @item.MaxCapacity <span class="glyphicon glyphicon-user"></span>]
                        </span>
                    }
                    else
                    {
                        <span class="btn btn-danger disabled">
                            [Max: @item.MaxCapacity <span class="glyphicon glyphicon-user"></span>]
                        </span>
                    }
                    @if (IsOwner())
                    {
                        //only logged in users should be able to edit and delete
                        //best if only the user modifies their own restaurant and not someone else's
                        <a class="btn btn-warning" href='@string.Format("/Tables/Edit/{0}", item.ID)'>
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        </a>

                        <a class="btn btn-danger" href='@string.Format("/Tables/Delete/{0}", item.ID)'>
                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </a>
                    }
                </td>

        counter++;

        if (counter % numPerRow == 1)
        {
                    @:</tr>
                }   
            }
        </tr>

    </table>

