@using Microsoft.AspNet.Identity;
@using System;
@using System.Globalization;
@model IEnumerable<Priority_Q.Models.Restaurant>

@{
    ViewBag.Title = "All Restaurants";
}

<h2>@ViewBag.Title</h2>

<p>
    @if (Request.IsAuthenticated)
    {
        //this is to prevent a random person from generating new restaurants
            <a class="btn btn-info" href='@string.Format("/Restaurants/Create")'>
                Create New Restaurant
            </a>
    }
</p>

@using (Html.BeginForm())
{
    <p>
        Find by name or location: @Html.TextBox("SearchString")
        <input type="submit" value="Search" />
    </p>
}

<table class="table table-striped table-hover ">
    @{
        var counter = 0;
    }

    @foreach (var item in Model)
    {
        <tr>
            <td>
            </td>
            <td>
                <a class="btn btn-info" href='@string.Format("/Restaurants/ViewTables/{0}", item.ID)'>
                    @Html.DisplayFor(modelItem => item.Name)
                </a>
            </td>
            <td>
                @if (ViewBag.CurrentHour >= item.OpeningHourStart && ViewBag.CurrentHour < item.OpeningHourEnd)
                {
                    <span class="label label-success">Open</span>
                }
                else
                {
                    <span class="label label-danger">Closed</span>
                }
                <br />
               
                Opening Hours: 
                @DateTime.ParseExact(item.OpeningHourStart.ToString(), "HH", CultureInfo.CurrentCulture).ToString("h:mm tt") 
                - 
                @DateTime.ParseExact(item.OpeningHourEnd.ToString(), "HH", CultureInfo.CurrentCulture).ToString("h:mm tt") 
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.StreetAddress) <br />
                @Html.DisplayFor(modelItem => item.City) <br />
                @Html.DisplayFor(modelItem => item.PhoneNumber)
            </td>
            <td>
 
            </td>
            <td>
       
            </td>
            <td>
                @if (Request.IsAuthenticated && item.UserID.Equals(User.Identity.GetUserId()))
                {
                    //only logged in users should be able to edit and delete
                    //best if only the user modifies their own restaurant and not someone else's
                    <a class="btn btn-warning" href='@string.Format("/Restaurants/Edit/{0}", item.ID)'> Edit </a>
                    <a class="btn btn-danger" href='@string.Format("/Restaurants/Delete/{0}", item.ID)'> Delete </a>
                }

            </td>
        </tr>
                counter++;
    }

</table>
